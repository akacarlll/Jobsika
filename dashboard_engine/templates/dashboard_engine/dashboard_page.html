{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Candidatures</title>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
 
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/dashboard_page.css' %}">

</head>
<body class="page-body">
    <header class="glass-effect main-header">
        <div class="container-main">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="header-title">Dashboard Candidatures</h1>
                        <p class="header-subtitle">Analyse des données de candidatures</p>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button id="refreshBtn" class="action-button">
                        <i class="fas fa-sync-alt"></i>
                        <span>Actualiser</span>
                    </button>
                    <button id="gotoJobEngine" 
                            data-url="{% url 'jobs_engine:add_job' %}"
                            class="action-button">
                        Job Engine
                    </button>
                    
                    <div class="last-update">
                        <i class="fas fa-clock mr-1"></i>
                        <span id="lastUpdate">{{ now|date:"d/m/Y H:i" }}</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container-main">
        <div class="stats-grid fade-in">
            <div class="stats-card">
                <div class="stats-card-content">
                    <div>
                        <p class="stat-label">Total Candidatures</p>
                        <p class="stat-value" id="totalApplications">{{ dashboards.stats.total|default:"0" }}</p>
                    </div>
                    <div class="stat-icon stat-icon-blue">
                        <i class="fas fa-paper-plane text-xl icon-blue"></i>
                    </div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-content">
                    <div>
                        <p class="stat-label">Villes Uniques</p>
                        <p class="stat-value" id="uniqueCities">{{ dashboards.stats.cities|default:"0" }}</p>
                    </div>
                    <div class="stat-icon stat-icon-green">
                        <i class="fas fa-map-marker-alt text-xl icon-green"></i>
                    </div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-content">
                    <div>
                        <p class="stat-label">Cette Semaine</p>
                        <p class="stat-value" id="thisWeek">{{ dashboards.stats.week|default:"0" }}</p>
                    </div>
                    <div class="stat-icon stat-icon-purple">
                        <i class="fas fa-calendar-week text-xl icon-purple"></i>
                    </div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-content">
                    <div>
                        <p class="stat-label">Taux de Réponse</p>
                        <p class="stat-value" id="responseRate">{{ dashboards.stats.response_rate|default:"0" }}%</p>
                    </div>
                    <div class="stat-icon stat-icon-orange">
                        <i class="fas fa-chart-pie text-xl icon-orange"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="map-section fade-in">
                <div class="chart-card">
                    <div class="chart-header chart-header-blue">
                        <h2 class="chart-title">
                            <i class="fas fa-globe-europe"></i>
                            Répartition Géographique des Candidatures
                        </h2>
                        <p class="chart-subtitle chart-subtitle-blue">Distribution des candidatures par ville</p>
                    </div>
                    <div class="chart-content">
                        <div class="map-container" id="mapDashboard">
                        </div>
                    </div>
                </div>
            </div>

            <div class="fade-in">
                <div class="chart-card">
                    <div class="chart-header chart-header-green">
                        <h2 class="chart-title">
                            <i class="fas fa-clock"></i>
                            Distribution par Heure
                        </h2>
                        <p class="chart-subtitle chart-subtitle-green">Heures de candidatures</p>
                    </div>
                    <div class="chart-content">
                        <div class="chart-container" id="hourlyDashboard">
                        </div>
                    </div>
                </div>
            </div>

            <div class="fade-in">
                <div class="chart-card">
                    <div class="chart-header chart-header-indigo">
                        <h2 class="chart-title">
                            <i class="fas fa-calendar-day"></i>
                            Distribution par Jour
                        </h2>
                        <p class="chart-subtitle chart-subtitle-indigo">Jours de la semaine</p>
                    </div>
                    <div class="chart-content">
                        <div class="chart-container" id="dailyDashboard">
                        </div>
                    </div>
                </div>
            </div>

            <div class="map-section fade-in">
                <div class="chart-card">
                    <div class="chart-header chart-header-pink">
                        <h2 class="chart-title">
                            <i class="fas fa-tools"></i>
                            Compétences les plus demandées
                        </h2>
                        <p class="chart-subtitle chart-subtitle-pink">Top compétences requises</p>
                    </div>
                    <div class="chart-content">
                        <div class="chart-container" id="skillsPieDashboard">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-info fade-in">
            <p class="text-sm">
                <i class="fas fa-info-circle mr-1"></i>
                Les données sont actualisées automatiquement depuis Google Sheets
            </p>
        </div>
    </main>
    {{ dashboards|json_script:"dashboardsData" }}
    <script src="{% static 'js/dashboard_page.js' %}"></script>
</body>
</html>